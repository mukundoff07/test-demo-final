(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{101:function(t,e,a){"use strict";a.r(e);var r=a(10),s=a(11),n=a(13),i=a(12),o=a(14),l=a(0),h=a.n(l),c=a(21),d=a.n(c),f=a(103),u=(a(44),a(8)),p=a(9),m=a(25),g=a.n(m),x=a(37),y=a(17),w=a(5),S=function(t){function e(){var t,a;Object(r.a)(this,e);for(var s=arguments.length,o=new Array(s),l=0;l<s;l++)o[l]=arguments[l];return(a=Object(n.a)(this,(t=Object(i.a)(e)).call.apply(t,[this].concat(o)))).getConnectorPoints=function(t){var e=t.points,a=t.from,r=t.to,s=t.mouseX,n=t.mouseY;if("FromAndTo"===t.type)if(r.attrs.name.includes("rect")&&a.attrs.name.includes("rect")){var i=r.attrs.y+r.attrs.height/2-(a.attrs.y+a.attrs.height/2),o=r.attrs.x+r.attrs.width/2-(a.attrs.x+a.attrs.width/2),l=Math.atan2(i,o)/Math.PI*180;l<=45&&l>=-45?(e[0]+=a.attrs.width,e[1]+=a.attrs.height/2,e[3]+=r.attrs.height/2):l>45&&l<135?(e[0]+=a.attrs.width/2,e[1]+=a.attrs.height,e[2]+=r.attrs.width/2):l>135&&l<180||l>-180&&l<-135?(e[1]+=a.attrs.height/2,e[2]+=r.attrs.width,e[3]+=r.attrs.height/2):l<-45&&l>-135&&(e[0]+=a.attrs.width/2,e[3]+=r.attrs.height,e[2]+=r.attrs.width/2)}else if(r.attrs.name.includes("rect")&&a.attrs.name.includes("text")){var h=a.textHeight||a.attrs.textHeight,c=a.textWidth||a.attrs.textWidth;i=r.attrs.y+r.attrs.height/2-(a.attrs.y+h/2),o=r.attrs.x+r.attrs.width/2-(a.attrs.x+c/2);var d=Math.atan2(i,o)/Math.PI*180;d<=45&&d>=-45?(e[0]+=c,e[1]+=h/2,e[3]+=r.attrs.height/2):d>45&&d<135?(e[0]+=c/2,e[1]+=h,e[2]+=r.attrs.width/2):d>135&&d<180||d>-180&&d<-135?(e[1]+=h/2,e[2]+=r.attrs.width,e[3]+=r.attrs.height/2):d<-45&&d>-135&&(e[0]+=c/2,e[3]+=r.attrs.height,e[2]+=r.attrs.width/2)}else if(r.attrs.name.includes("ellipse")&&a.attrs.name.includes("ellipse")){var f={x:a.attrs.x,y:a.attrs.y},u=e[3]-e[1],p=e[2]-e[0],m=Math.atan2(-u,p);e[0]+=-a.attrs.radiusX*Math.cos(m+Math.PI),e[1]+=a.attrs.radiusY*Math.sin(m+Math.PI),e[2]+=r.attrs.radiusX*Math.cos(m+Math.PI),e[3]-=r.attrs.radiusY*Math.sin(m+Math.PI)}else if(r.attrs.name.includes("star")&&a.attrs.name.includes("star")){f={x:a.attrs.x,y:a.attrs.y},i=e[3]-e[1],o=e[2]-e[0];var g=Math.atan2(-i,o);e[0]+=-a.attrs.outerRadius*Math.cos(g+Math.PI),e[1]+=a.attrs.outerRadius*Math.sin(g+Math.PI),e[2]+=r.attrs.outerRadius*Math.cos(g+Math.PI),e[3]-=r.attrs.outerRadius*Math.sin(g+Math.PI)}else if(r.attrs.name.includes("text")&&a.attrs.name.includes("text")){var x=a.textHeight||a.attrs.textHeight,y=a.textWidth||a.attrs.textWidth,w=r.textHeight||r.attrs.textHeight,S=r.textWidth||r.attrs.textWidth;i=r.attrs.y+w/2-(a.attrs.y+x/2),o=r.attrs.x+S/2-(a.attrs.x+y/2);var v=Math.atan2(i,o)/Math.PI*180;v<=45&&v>=-45?(e[0]+=y,e[1]+=x/2,e[3]+=w/2):v>45&&v<135?(e[0]+=y/2,e[1]+=x,e[2]+=S/2):v>135&&v<180||v>-180&&v<-135?(e[1]+=x/2,e[2]+=S,e[3]+=w/2):v<-45&&v>-135&&(e[0]+=y/2,e[3]+=w,e[2]+=S/2)}else if(a.attrs.name.includes("rect")&&r.attrs.name.includes("ellipse")){var k=r.attrs.y+-(a.attrs.y+a.attrs.height/2),M=r.attrs.x+-(a.attrs.x+a.attrs.width/2),b=Math.atan2(k,M)/Math.PI*180;b<=-45&&b>=-135?e[0]+=a.attrs.width/2:b>45&&b<135?(e[0]+=a.attrs.width/2,e[1]+=a.attrs.height):b>135&&b<180||b>-180&&b<-135?e[1]+=a.attrs.height/2:b>-45&&b<45&&(e[0]+=a.attrs.width,e[1]+=a.attrs.height/2);var E=e[3]-e[1],P=e[2]-e[0];b=Math.atan2(-E,P),e[2]+=r.attrs.radiusX*Math.cos(b+Math.PI),e[3]-=r.attrs.radiusY*Math.sin(b+Math.PI)}else if(a.attrs.name.includes("rect")&&r.attrs.name.includes("star")){k=r.attrs.y+-(a.attrs.y+a.attrs.height/2),M=r.attrs.x+-(a.attrs.x+a.attrs.width/2),(b=Math.atan2(k,M)/Math.PI*180)<=-45&&b>=-135?e[0]+=a.attrs.width/2:b>45&&b<135?(e[0]+=a.attrs.width/2,e[1]+=a.attrs.height):b>135&&b<180||b>-180&&b<-135?e[1]+=a.attrs.height/2:b>-45&&b<45&&(e[0]+=a.attrs.width,e[1]+=a.attrs.height/2);var R=e[3]-e[1],C=e[2]-e[0];b=Math.atan2(-R,C),e[2]+=r.attrs.outerRadius*Math.cos(b+Math.PI),e[3]-=r.attrs.outerRadius*Math.sin(b+Math.PI)}else if(a.attrs.name.includes("rect")&&r.attrs.name.includes("text")){var D=r.textHeight||r.attrs.textHeight,I=r.textWidth||r.attrs.textWidth;console.log(r),i=r.attrs.y+D/2-(a.attrs.y+a.attrs.height/2),o=r.attrs.x+I/2-(a.attrs.x+a.attrs.width/2);var T=Math.atan2(i,o)/Math.PI*180;T<=45&&T>=-45?(e[0]+=a.attrs.width,e[1]+=a.attrs.height/2,e[3]+=D/2):T>45&&T<135?(e[0]+=a.attrs.width/2,e[1]+=a.attrs.height,e[2]+=I/2):T>135&&T<180||T>-180&&T<-135?(e[1]+=a.attrs.height/2,e[2]+=I,e[3]+=D/2):T<-45&&T>-135&&(e[0]+=a.attrs.width/2,e[3]+=D,e[2]+=I/2)}else if(a.attrs.name.includes("ellipse")&&r.attrs.name.includes("rect")){k=r.attrs.y+r.attrs.height/2-a.attrs.y,M=r.attrs.x+r.attrs.width/2-a.attrs.x,(b=Math.atan2(k,M)/Math.PI*180)<=-45&&b>=-135?(e[2]+=r.attrs.width/2,e[3]+=r.attrs.height):b>45&&b<135?e[2]+=r.attrs.width/2:b>135&&b<180||b>-180&&b<-135?(e[2]+=r.attrs.width,e[3]+=r.attrs.height/2):b>-45&&b<45&&(e[3]+=r.attrs.height/2);var W=e[3]-e[1],O=e[2]-e[0];b=Math.atan2(-W,O),e[0]-=a.attrs.radiusX*Math.cos(b+Math.PI),e[1]+=a.attrs.radiusY*Math.sin(b+Math.PI)}else if(a.attrs.name.includes("ellipse")&&r.attrs.name.includes("text")){var A=r.textHeight||r.attrs.textHeight,N=r.textWidth||r.attrs.textWidth;k=r.attrs.y+A/2-a.attrs.y,M=r.attrs.x+N/2-a.attrs.x,(b=Math.atan2(k,M)/Math.PI*180)<=-45&&b>=-135?(e[2]+=N/2,e[3]+=A):b>45&&b<135?e[2]+=N/2:b>135&&b<180||b>-180&&b<-135?(e[2]+=N,e[3]+=A/2):b>-45&&b<45&&(e[3]+=A/2);var X=e[3]-e[1],j=e[2]-e[0];b=Math.atan2(-X,j),e[0]-=a.attrs.radiusX*Math.cos(b+Math.PI),e[1]+=a.attrs.radiusY*Math.sin(b+Math.PI),console.log("new points",e,"from",a,"from coord",a.attrs)}else if(a.attrs.name.includes("ellipse")&&r.attrs.name.includes("star")){f={x:a.attrs.x,y:a.attrs.y};var Y=e[3]-e[1],H=e[2]-e[0],F=Math.atan2(-Y,H);e[0]+=-a.attrs.radiusX*Math.cos(F+Math.PI),e[1]+=a.attrs.radiusY*Math.sin(F+Math.PI),e[2]+=r.attrs.outerRadius*Math.cos(F+Math.PI),e[3]-=r.attrs.outerRadius*Math.sin(F+Math.PI)}else if(a.attrs.name.includes("star")&&r.attrs.name.includes("ellipse")){f={x:a.attrs.x,y:a.attrs.y};var U=e[3]-e[1],z=e[2]-e[0],J=Math.atan2(-U,z);e[0]+=-a.attrs.outerRadius*Math.cos(J+Math.PI),e[1]+=a.attrs.outerRadius*Math.sin(J+Math.PI),e[2]+=r.attrs.radiusX*Math.cos(J+Math.PI),e[3]-=r.attrs.radiusY*Math.sin(J+Math.PI)}else if(a.attrs.name.includes("star")&&r.attrs.name.includes("rect")){k=r.attrs.y+r.attrs.width/2-a.attrs.y,M=r.attrs.x+r.attrs.width/2-a.attrs.x,(b=Math.atan2(k,M)/Math.PI*180)<=-45&&b>=-135?(e[2]+=r.attrs.width/2,e[3]+=r.attrs.height):b>45&&b<135?e[2]+=r.attrs.width/2:b>135&&b<180||b>-180&&b<-135?(e[2]+=r.attrs.width,e[3]+=r.attrs.height/2):b>-45&&b<45&&(e[3]+=r.attrs.width/2);var B=e[3]-e[1],K=e[2]-e[0];b=Math.atan2(-B,K),e[0]-=a.attrs.outerRadius*Math.cos(b+Math.PI),e[1]+=a.attrs.outerRadius*Math.sin(b+Math.PI)}else if(a.attrs.name.includes("star")&&r.attrs.name.includes("text")){var L=r.textHeight||r.attrs.textHeight,V=r.textWidth||r.attrs.textWidth;k=r.attrs.y+L/2-a.attrs.y,M=r.attrs.x+V/2-a.attrs.x,(b=Math.atan2(k,M)/Math.PI*180)<=-45&&b>=-135?(e[2]+=V/2,e[3]+=L):b>45&&b<135?e[2]+=V/2:b>135&&b<180||b>-180&&b<-135?(e[2]+=V,e[3]+=L/2):b>-45&&b<45&&(e[3]+=L/2);var G=e[3]-e[1],q=e[2]-e[0];b=Math.atan2(-G,q),e[0]-=a.attrs.outerRadius*Math.cos(b+Math.PI),e[1]+=a.attrs.outerRadius*Math.sin(b+Math.PI)}else if(a.attrs.name.includes("text")&&r.attrs.name.includes("star")){var Q=a.textHeight||a.attrs.textHeight,Z=a.textWidth||a.attrs.textWidth;k=r.attrs.y+-(a.attrs.y+Q/2),M=r.attrs.x+-(a.attrs.x+Z/2),(b=Math.atan2(k,M)/Math.PI*180)<=-45&&b>=-135?e[0]+=Z/2:b>45&&b<135?(e[0]+=Z/2,e[1]+=Q):b>135&&b<180||b>-180&&b<-135?e[1]+=Q/2:b>-45&&b<45&&(e[0]+=Z,e[1]+=Q/2);var $=e[3]-e[1],_=e[2]-e[0];b=Math.atan2(-$,_),e[2]+=r.attrs.outerRadius*Math.cos(b+Math.PI),e[3]-=r.attrs.outerRadius*Math.sin(b+Math.PI)}else if(a.attrs.name.includes("text")&&r.attrs.name.includes("ellipse")){var tt=a.textHeight||a.attrs.textHeight,et=a.textWidth||a.attrs.textWidth;k=r.attrs.y+-(a.attrs.y+tt/2),M=r.attrs.x+-(a.attrs.x+et/2),(b=Math.atan2(k,M)/Math.PI*180)<=-45&&b>=-135?e[0]+=et/2:b>45&&b<135?(e[0]+=et/2,e[1]+=tt):b>135&&b<180||b>-180&&b<-135?e[1]+=tt/2:b>-45&&b<45&&(e[0]+=et,e[1]+=tt/2);var at=e[3]-e[1],rt=e[2]-e[0];b=Math.atan2(-at,rt),e[2]+=r.attrs.radiusX*Math.cos(b+Math.PI),e[3]-=r.attrs.radiusY*Math.sin(b+Math.PI)}if("onlyFrom"===t.type)if(a.attrs.name.includes("rect"))i=n-(f={x:a.attrs.x+a.attrs.width/2,y:a.attrs.y+a.attrs.height/2}).y,o=s-f.x,(b=Math.atan2(i,o)/Math.PI*180)<=-45&&b>=-135?e[0]+=a.attrs.width/2:b>45&&b<135?(e[0]+=a.attrs.width/2,e[1]+=a.attrs.height):b>135&&b<180||b>-180&&b<-135?e[1]+=a.attrs.height/2:b>-45&&b<45&&(e[0]+=a.attrs.width,e[1]+=a.attrs.height/2);else if(a.attrs.name.includes("ellipse")){f={x:a.attrs.x,y:a.attrs.y};var st=e[3]-e[1],nt=e[2]-e[0],it=Math.atan2(-st,nt);e[0]+=-a.attrs.radiusX*Math.cos(it+Math.PI),e[1]+=a.attrs.radiusY*Math.sin(it+Math.PI)}else if(a.attrs.name.includes("star")){f={x:a.attrs.x,y:a.attrs.y};var ot=e[3]-e[1],lt=e[2]-e[0],ht=Math.atan2(-ot,lt);e[0]+=-a.attrs.outerRadius*Math.cos(ht+Math.PI),e[1]+=a.attrs.outerRadius*Math.sin(ht+Math.PI)}else if(a.attrs.name.includes("text")){var ct=a.textHeight||a.attrs.textHeight,dt=a.textWidth||a.attrs.textWidth;i=n-(f={x:a.attrs.x+dt/2,y:a.attrs.y+dt/2}).y,o=s-f.x,(b=Math.atan2(i,o)/Math.PI*180)<=-45&&b>=-135?e[0]+=dt/2:b>45&&b<135?(e[0]+=dt/2,e[1]+=ct):b>135&&b<180||b>-180&&b<-135?e[1]+=ct/2:b>-45&&b<45&&(e[0]+=dt,e[1]+=ct/2)}if("onlyTo"===t.type)if(r.attrs.name.includes("rect")){var ft={x:e[0],y:e[1]};f={x:r.attrs.x+r.attrs.width/2,y:r.attrs.y+r.attrs.height/2},i=ft.y-f.y,o=ft.x-f.x,(b=Math.atan2(i,o)/Math.PI*180)>45&&b<135?(e[2]+=r.attrs.width/2,e[3]+=r.attrs.height):b>135&&b<180||b>-180&&b<-135?e[3]+=r.attrs.height/2:b>-135&&b<-45?e[2]+=r.attrs.width/2:(e[2]+=r.attrs.width,e[3]+=r.attrs.height/2)}else if(r.attrs.name.includes("ellipse")){var ut=e[3]-e[1],pt=e[2]-e[0],mt=Math.atan2(-ut,pt);e[2]+=r.attrs.radiusX*Math.cos(mt+Math.PI),e[3]-=r.attrs.radiusY*Math.sin(mt+Math.PI)}else if(r.attrs.name.includes("star")){var gt=e[3]-e[1],xt=e[2]-e[0],yt=Math.atan2(-gt,xt);e[2]+=r.attrs.outerRadius*Math.cos(yt+Math.PI),e[3]-=r.attrs.outerRadius*Math.sin(yt+Math.PI)}else if(r.attrs.name.includes("text")){var wt=r.textHeight||r.attrs.textHeight,St=r.textWidth||r.attrs.textWidth;ft={x:e[0],y:e[1]},f={x:r.attrs.x+St/2,y:r.attrs.y+St/2},i=ft.y-f.y,o=ft.x-f.x,(b=Math.atan2(i,o)/Math.PI*180)>45&&b<135?(e[2]+=St/2,e[3]+=wt):b>135&&b<180||b>-180&&b<-135?e[3]+=wt/2:b>-135&&b<-45?e[2]+=St/2:(e[2]+=wt,e[3]+=wt/2)}return e},a}return Object(o.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){var t=null;if(this.props.current&&this.props.from){var e={points:t=[this.props.from.attrs.x,this.props.from.attrs.y,this.props.arrowEndX,this.props.arrowEndY],from:this.props.from,mouseX:this.props.arrowEndX,mouseY:this.props.arrowEndY,type:"onlyFrom"};t=this.getConnectorPoints(e)}if(!1===this.props.current)if(this.props.from&&this.props.to){var a={points:t=[this.props.from.attrs.x,this.props.from.attrs.y,this.props.to.attrs.x,this.props.to.attrs.y],from:this.props.from,to:this.props.to,type:"FromAndTo"};t=this.getConnectorPoints(a)}else if(this.props.from){var r={points:t=[this.props.from.attrs.x,this.props.from.attrs.y,this.props.points[2],this.props.points[3]],from:this.props.from,mouseX:this.props.points[2],mouseY:this.props.points[3],type:"onlyFrom"};t=this.getConnectorPoints(r)}else if(this.props.to){var s={points:t=[this.props.points[0],this.props.points[1],this.props.to.attrs.x,this.props.to.attrs.y],to:this.props.to,type:"onlyTo",mouseX:this.props.to.attrs.x,mouseY:this.props.to.attrs.y};t=this.getConnectorPoints(s)}return h.a.createElement(w.Arrow,{name:this.props.name,points:t,strokeWidth:1.5,stroke:this.props.stroke,fill:this.props.fill})}}]),e}(l.Component),v=function(){return h.a.createElement(w.Rect,{y:80,width:77.5,height:355,fill:"white",shadowBlur:5,shadowColor:"black"})},k=function(t){function e(){var t,a;Object(r.a)(this,e);for(var s=arguments.length,o=new Array(s),l=0;l<s;l++)o[l]=arguments[l];return(a=Object(n.a)(this,(t=Object(i.a)(e)).call.apply(t,[this].concat(o)))).state={arrowDraggable:!1,previousShape:void 0,count:0,isDragging:!1},a}return Object(o.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){var t=this;return h.a.createElement(h.a.Fragment,null,this.props.layer?h.a.createElement(h.a.Fragment,null,h.a.createElement(v,null),h.a.createElement(w.Ellipse,{radiusX:20,radiusY:20,stroke:"black",strokeWidth:1.5,x:37.5,y:125}),h.a.createElement(w.Ellipse,{radiusX:20,radiusY:20,stroke:"black",strokeWidth:1.5,x:37.5,y:125,draggable:!0,ref:"draggableEllipse",onDragEnd:function(e){var a="ellipse"+t.props.ellipseName,r={x:e.target.x(),y:e.target.y(),radiusX:20,radiusY:20,stroke:"black",strokeWidth:1.5,name:a,fill:"white",ref:a,rotation:0};t.props.appendToEllipses(r),t.refs.draggableEllipse.position({x:37.5,y:125})}}),h.a.createElement(w.Rect,{width:35,height:35,stroke:"black",strokeWidth:1.5,x:20,y:180,fill:"white"}),h.a.createElement(w.Rect,{width:35,height:35,stroke:"black",strokeWidth:1.5,x:20,y:180,draggable:!0,fill:"white",ref:"draggableRect",onDragEnd:function(e){var a="rectangle"+t.props.rectName,r={x:e.target.x(),y:e.target.y(),width:35,height:35,stroke:"black",strokeWidth:1.5,rotation:0,name:a,ref:a,fill:"white",useImage:!1};t.props.appendToRectangles(r),t.refs.draggableRect.position({x:20,y:180})}}),h.a.createElement(w.Star,{innerRadius:8,outerRadius:20,numPoints:5,stroke:"black",strokeWidth:1.5,x:37.5,y:270,fill:"white"}),h.a.createElement(w.Star,{innerRadius:8,outerRadius:20,numPoints:5,stroke:"black",strokeWidth:1.5,x:37.5,y:270,draggable:!0,ref:"draggableStar",onDragEnd:function(e){var a="star"+t.props.starName,r={x:e.target.x(),y:e.target.y(),innerRadius:8,outerRadius:20,numPoints:5,stroke:"black",strokeWidth:1.5,name:a,fill:"white",ref:a,rotation:0};t.props.appendToStars(r),t.refs.draggableStar.position({x:37.5,y:270})}}),h.a.createElement(w.Text,{fontSize:40,text:"T",fontFamily:"Belgrano",x:24,y:320}),h.a.createElement(w.Text,{fontSize:40,text:"T",fontFamily:"Belgrano",x:24,y:320,draggable:!0,ref:"draggableText",onDragEnd:function(e){var a="text"+t.props.textName,r="text"+t.props.textName,s={x:e.target.x(),y:e.target.y(),fontSize:25,fontFamily:"Belgrano",ref:r,name:a,text:"",fill:"black",width:300,height:25,rotation:0,textWidth:t.refs.draggableText.textWidth,textHeight:t.refs.draggableText.textHeight};console.log("tosend",s),t.props.appendToTexts(s),t.refs.draggableText.position({x:24,y:320})}}),h.a.createElement(w.Arrow,{points:[20,400,50,400],fill:"black",stroke:"black"}),h.a.createElement(w.Arrow,{points:[20,400,50,400],fill:"black",stroke:"black",ref:"draggableArrow",name:"draggableArrow",draggable:!0,onDragStart:function(){t.refs.draggableArrow.setAttr("fill","grey"),t.refs.draggableArrow.setAttr("stroke","grey")},onDragMove:function(){var e=t.props.layer.getStage().getPointerPosition(),a=t.props.layer.getIntersection(e);void 0!==t.state.previousShape&&null!==t.state.previousShape&&(t.state.previousShape!==a?"ContainerRect"===t.state.previousShape.attrs.id||t.state.previousShape.attrs.name.includes("arrow")||(t.refs.draggableArrow.setAttr("fill","black"),t.refs.draggableArrow.setAttr("stroke","black")):"ContainerRect"===t.state.previousShape.attrs.id||a.attrs.name.includes("arrow")||(t.refs.draggableArrow.setAttr("fill","#ccf5ff"),t.refs.draggableArrow.setAttr("stroke","#ccf5ff"))),t.props.layer.draw(),t.setState({previousShape:a})},onDragEnd:function(e){var a=t.props.layer.getStage().getPointerPosition(),r=t.props.layer.getIntersection(a);if(r&&void 0===r.attrs.id&&!r.attrs.name.includes("arrow")){var s={x:a.x,y:a.y,points:[20,475,60,475],from:r,stroke:"black",strokeWidth:"1.5",fill:"black"};console.log("from shape",r),t.props.newArrowOnDragEnd(s)}else{var n={x:a.x,y:a.y,points:[20,475,60,475],stroke:"black",strokeWidth:"1.5",fill:"black"};t.props.newArrowOnDragEnd(n)}var i=t.refs.draggableArrow;i.position({x:0,y:0}),i.setAttr("fill","black"),i.setAttr("stroke","black"),i.draw()}})):null)}}]),e}(l.Component),M=(a(97),function(t){function e(){return Object(r.a)(this,e),Object(n.a)(this,Object(i.a)(e).apply(this,arguments))}return Object(o.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){this.checkNode()}},{key:"componentDidUpdate",value:function(){this.checkNode()}},{key:"checkNode",value:function(){var t=this.transformer.getStage(),e=this.props.selectedShapeName;if(""!==e){var a=t.findOne("."+e);a!==this.transformer.node()&&(a?this.transformer.attachTo(a):this.transformer.detach(),this.transformer.getLayer().batchDraw())}else this.transformer.detach()}},{key:"render",value:function(){var t=this;if(this.props.selectedShapeName.includes("text"))var e=h.a.createElement(w.Transformer,{ref:function(e){t.transformer=e},name:"transformer",boundBoxFunc:function(t,e){return e.width=Math.max(30,e.width),e},enabledAnchors:["middle-left","middle-right"]});else if(this.props.selectedShapeName.includes("star"))e=h.a.createElement(w.Transformer,{ref:function(e){t.transformer=e},name:"transformer",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]});else if(this.props.selectedShapeName.includes("arrow"))e=h.a.createElement(w.Transformer,{ref:function(e){t.transformer=e},name:"transformer",resizeEnabled:!1,rotateEnabled:!1});else e=h.a.createElement(w.Transformer,{ref:function(e){t.transformer=e},name:"transformer",keepRatio:!0});return e}}]),e}(h.a.Component)),b=[],E=0,P=function(t){function e(t){var a;return Object(r.a)(this,e),(a=Object(n.a)(this,Object(i.a)(e).call(this,t))).handleSave=function(){var t=a.state.rectangles,e=a.state.ellipses,r=a.state.stars,s=a.state.texts,n=a.state.arrows;if(JSON.stringify(a.state.saved)!==JSON.stringify([t,e,r,s,n])){a.setState({saved:[t,e,r,s,n]});var i=a.state.arrows;i.forEach(function(t){t.from&&t.from.attrs&&t.from.attrs.name.includes("text")&&(t.from.textWidth=t.from.textWidth,t.from.textHeight=t.from.textHeight),t.to&&t.to.attrs&&t.to.attrs.name.includes("text")&&(t.to.attrs.textWidth=t.to.textWidth,t.to.attrs.textHeight=t.to.textHeight)}),a.state.roadmapId?(a.setState({saving:!0}),fetch("/api/roadmap/modifyDraftDB",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roadmapId:a.state.roadmapId,data:{rects:t,ellipses:e,stars:r,texts:s,arrows:i}})}).then(function(t){a.setState({saving:!1})})):(a.setState({saving:!0}),fetch("/api/roadmap/saveRoadmapToDB",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a.props.auth.user.id,roadmapType:"draft",data:{rects:t,ellipses:e,stars:r,texts:s,arrows:n}})}).then(function(t){return t.json().then(function(t){a.setState({saving:!1}),a.setState({roadmapId:t.roadmapId})})}))}},a.handleStageClick=function(t){var e=a.refs.layer2.getStage().getPointerPosition(),r=a.refs.layer2.getIntersection(e);console.log("texts",a.state.texts),null!==r&&void 0!==r.name()&&void 0!==r&&void 0!==r.name()&&a.setState({selectedShapeName:r.name()},function(){a.refs.graphicStage.draw()}),""!==a.state.newArrowRef&&(a.state.previousShape&&"ContainerRect"!==a.state.previousShape.attrs.id&&a.state.arrows.map(function(t){t.name===a.state.newArrowRef&&(t.to=a.state.previousShape)}),a.state.arrows.map(function(t){t.name===a.state.newArrowRef&&(t.fill="black",t.stroke="black")}),a.setState({arrowDraggable:!1,newArrowRef:""}))},a.handleMouseOver=function(t){var e=a.refs.graphicStage.getPointerPosition(),r=a.refs.graphicStage.getIntersection(e);if(r&&r.attrs.link?document.body.style.cursor="pointer":document.body.style.cursor="default",""!==a.state.newArrowRef){var s=a.refs.layer2.getAbsoluteTransform().copy();s.invert(),e=s.point(e),a.setState({arrowEndX:e.x,arrowEndY:e.y}),r&&r.attrs&&void 0!=r.attrs.name&&(r.attrs.name.includes("arrow")||a.state.previousShape&&a.state.previousShape!==r&&("ContainerRect"!==a.state.previousShape.attrs.id?(a.state.arrows.map(function(t){t.name===a.state.newArrowRef&&(t.fill="black",t.stroke="black")}),a.forceUpdate()):(a.state.arrows.map(function(t){t.name===a.state.newArrowRef&&(t.fill="#ccf5ff",t.stroke="#ccf5ff")}),a.forceUpdate())),r.attrs.name.includes("arrow")||a.setState({previousShape:r}))}var n=a.state.arrows;n.map(function(t){if(t.name===a.state.newArrowRef){var r=n.indexOf(t),s=t;s.points=[s.points[0],s.points[1],e.x,e.y],a.state.arrows[r]=s}})},a.handleUndo=function(){if(!a.state.isTransforming&&!a.state.textEditVisible){if(0===E)return;E-=1,a.setState({rectangles:b[E].rectangles,arrows:b[E].arrows,ellipses:b[E].ellipses,stars:b[E].stars,texts:b[E].texts,connectors:b[E].connectors,redoing:!0,selectedShapeName:a.shapeIsGone(b[E])?"":a.state.selectedShapeName},function(){a.refs.graphicStage.draw()})}},a.handleRedo=function(){if(E!==b.length-1){var t=b[E+=1];a.setState({rectangles:t.rectangles,arrows:t.arrows,ellipses:t.ellipses,stars:t.stars,texts:t.texts,redoing:!0,selectedShapeName:a.shapeIsGone(b[E])?"":a.state.selectedShapeName},function(){a.forceUpdate()})}},a.shapeIsGone=function(t){var e=!0,r=a.state.selectedShapeName,s=[t.rectangles,t.ellipses,t.stars,t.arrows,t.texts],n=s[1],i=s[2],o=s[3],l=s[4];return s[0].map(function(t){t.name===r&&(e=!1)}),n.map(function(t){t.name===r&&(e=!1)}),i.map(function(t){t.name===r&&(e=!1)}),o.map(function(t){t.name===r&&(e=!1)}),l.map(function(t){t.name===r&&(e=!1)}),e},a.IsJsonString=function(t){try{JSON.parse(t)}catch(e){return!1}return!0},a.state={layerX:0,layerY:0,layerScale:1,selectedShapeName:"",errMsg:"",rectangles:[],ellipses:[],stars:[],texts:[],arrows:[],connectors:[],currentTextRef:"",shouldTextUpdate:!0,textX:0,textY:0,textEditVisible:!1,arrowDraggable:!1,newArrowRef:"",count:0,newArrowDropped:!1,newConnectorDropped:!1,arrowEndX:0,arrowEndY:0,isTransforming:!1,lastFill:null,saving:null,saved:[],roadmapId:null,alreadyCreated:!1,publishing:!1,title:"",category:"",description:"",thumbnail:"",isPasteDisabled:!1,ellipseDeleteCount:0,starDeleteCount:0,arrowDeleteCount:0,textDeleteCount:0,rectDeleteCount:0},a.handleWheel=a.handleWheel.bind(Object(y.a)(Object(y.a)(a))),a}return Object(o.a)(e,t),Object(s.a)(e,[{key:"handleWheel",value:function(t){if(0===this.state.rectangles.length&&0===this.state.ellipses.length&&0===this.state.stars.length&&0===this.state.texts.length&&0===this.state.arrows.length);else{t.evt.preventDefault();var e=this.refs.graphicStage,a=this.refs.layer2,r=a.scaleX(),s={x:e.getPointerPosition().x/r-this.state.layerX/r,y:e.getPointerPosition().y/r-this.state.layerY/r},n=t.evt.deltaY<0?1.2*r:r/1.2;a.scale({x:n,y:n}),this.setState({layerScale:n,layerX:-(s.x-e.getPointerPosition().x/n)*n,layerY:-(s.y-e.getPointerPosition().y/n)*n})}}},{key:"componentDidUpdate",value:function(t,e){var a=[e.rectangles,e.ellipses,e.stars,e.arrows,e.connectors,e.texts],r=[this.state.rectangles,this.state.ellipses,this.state.stars,this.state.arrows,this.state.connectors,this.state.texts];if(!this.state.redoing&&!this.state.isTransforming&&JSON.stringify(this.state)!==JSON.stringify(e)&&JSON.stringify(a)!==JSON.stringify(r)&&this.state.shouldTextUpdate){b=b.slice(0,E+1);var s=this.state;b=b.concat(s),E+=1}this.state.redoing=!1}},{key:"componentDidMount",value:function(){var t=Object(x.a)(g.a.mark(function t(){return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:b.push(this.state),this.setState({selectedShapeName:""});case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this,e=this.state.saving;null!==e&&(e?h.a.createElement("div",{style:{color:"white"}},"Saving"):h.a.createElement("div",{style:{color:"white"}},"Saved"));var a=document.createElement("canvas").getContext("2d").createLinearGradient(0,0,100,100);a.addColorStop(0,"red"),a.addColorStop(1/6,"orange"),a.addColorStop(2/6,"yellow"),a.addColorStop(.5,"green"),a.addColorStop(4/6,"aqua"),a.addColorStop(5/6,"blue"),a.addColorStop(1,"purple");var r,s=this.state.errMsg;""!==s&&(r=h.a.createElement("div",{className:"errMsginner"},h.a.createElement("span",{style:{color:"white"}},""!==s?s:null)));return h.a.createElement(h.a.Fragment,null,h.a.createElement("div",{onKeyDown:function(e){if((e.ctrlKey&&88===e.keyCode||46===e.keyCode)&&!t.state.isPasteDisabled){if(""!==t.state.selectedShapeName){var a=t,r=t.state.selectedShapeName,s=t.state.rectangles.filter(function(t){return t.name===r&&a.setState({rectDeleteCount:a.state.rectDeleteCount+1}),t.name!==r}),n=t.state.ellipses.filter(function(t){return t.name===r&&a.setState({ellipseDeleteCount:a.state.ellipseDeleteCount+1}),t.name!==r}),i=t.state.stars.filter(function(t){return t.name===r&&a.setState({starDeleteCount:a.state.starDeleteCount+1}),t.name!==r}),o=t.state.arrows.filter(function(t){return t.name===r&&a.setState({arrowDeleteCount:a.state.arrowDeleteCount+1}),t.name!==r}),l=t.state.texts.filter(function(t){return t.name===r&&a.setState({textDeleteCount:a.state.textDeleteCount+1}),t.name!==r});t.setState({rectangles:s,ellipses:n,stars:i,arrows:o,texts:l,selectedShapeName:""})}}else if(e.shiftKey&&e.ctrlKey&&90===e.keyCode)t.handleRedo();else if(e.ctrlKey&&90===e.keyCode)t.handleUndo();else if(e.ctrlKey&&89===e.keyCode)t.handleRedo();else if(e.ctrlKey&&67===e.keyCode){if(""!==t.state.selectedShapeName){var h=t.state.selectedShapeName,c=null;h.includes("rect")?c=t.state.rectangles.filter(function(t){return t.name===h}):h.includes("ellipse")?c=t.state.ellipses.filter(function(t){return t.name===h}):h.includes("star")?c=t.state.stars.filter(function(t){return t.name===h}):h.includes("text")?c=t.state.texts.filter(function(t){return t.name===h}):h.includes("arrow")&&(c=t.state.arrows.filter(function(t){return t.name===h})),t.setState({copiedElement:c},function(){console.log("copied ele",t.state.copiedElement)})}}else if(e.ctrlKey&&86===e.keyCode&&!t.state.isPasteDisabled){var d=t.state.copiedElement[0];if(console.log(d),d)if(d.attrs);else if(d.name.includes("rectangle")){t.state.rectangles.length+1+t.state.rectDeleteCount;var f={x:d.x+10,y:d.y+10,width:d.width,height:d.height,stroke:d.stroke,strokeWidth:d.strokeWidth,name:"rectangle"+(t.state.rectangles.length+t.state.rectDeleteCount+1),ref:"rectangle"+(t.state.rectangles.length+t.state.rectDeleteCount+1),fill:d.fill,useImage:d.useImage,link:d.link,rotation:d.rotation};t.state.selectedShapeName;t.setState(function(t){return{rectangles:[].concat(Object(p.a)(t.rectangles),[f])}},function(){t.setState({selectedShapeName:"rectangle"+t.state.rectangles.length})})}else if(d.name.includes("arrow"))if(t.state.arrows.length+1+t.state.arrowDeleteCount,d.to||d.from)t.setState({errMsg:"Connectors cannot be pasted"},function(){var e=t;setTimeout(function(){e.setState({errMsg:""})},1e3)});else{f={points:[d.points[0]+30,d.points[1]+30,d.points[2]+30,d.points[3]+30],fill:d.fill,link:d.link,stroke:d.stroke,strokeWidth:d.strokeWidth,name:"arrow"+(t.state.arrows.length+1+t.state.arrowDeleteCount),ref:"arrow"+(t.state.arrows.length+1+t.state.arrowDeleteCount),rotation:d.rotation},t.state.selectedShapeName;t.setState(function(t){return{arrows:[].concat(Object(p.a)(t.arrows),[f])}},function(){t.setState({selectedShapeName:"arrow"+t.state.arrows.length})})}else if(d.name.includes("ellipse")){t.state.ellipses.length+1+t.state.ellipseDeleteCount;f={x:d.x+10,y:d.y+10,radiusX:d.radiusX,radiusY:d.radiusY,stroke:d.stroke,strokeWidth:d.strokeWidth,name:"ellipse"+(t.state.ellipses.length+1+t.state.ellipseDeleteCount),ref:"ellipse"+(t.state.ellipses.length+1+t.state.ellipseDeleteCount),fill:d.fill,link:d.link,useImage:d.useImage,rotation:d.rotation},t.state.selectedShapeName;t.setState(function(t){return{ellipses:[].concat(Object(p.a)(t.ellipses),[f])}},function(){t.setState({selectedShapeName:"ellipse"+t.state.ellipses.length})})}else if(d.name.includes("star")){t.state.stars.length+1+t.state.starDeleteCount;f={x:d.x+10,y:d.y+10,link:d.link,innerRadius:d.innerRadius,outerRadius:d.outerRadius,stroke:d.stroke,strokeWidth:d.strokeWidth,name:"star"+(t.state.stars.length+1+t.state.starDeleteCount),ref:"star"+(t.state.stars.length+1+t.state.starDeleteCount),fill:d.fill,useImage:d.useImage,rotation:d.rotation},t.state.selectedShapeName;t.setState(function(t){return{stars:[].concat(Object(p.a)(t.stars),[f])}},function(){t.setState({selectedShapeName:"star"+t.state.stars.length})})}else if(d.name.includes("text")){t.state.texts.length+1+t.state.textDeleteCount;f={x:d.x+10,y:d.y+10,link:d.link,name:"text"+(t.state.texts.length+1+t.state.textDeleteCount),ref:"text"+(t.state.texts.length+1+t.state.textDeleteCount),fill:d.fill,fontSize:d.fontSize,fontFamily:d.fontFamily,useImage:d.useImage,text:d.text,width:d.width,rotation:d.rotation},t.state.selectedShapeName;t.setState(function(t){return{texts:[].concat(Object(p.a)(t.texts),[f])}},function(){t.setState({selectedShapeName:"text"+(t.state.texts.length+t.state.textDeleteCount)},function(){console.log(t.state.selectedShapeName)})})}}},tabIndex:"0",style:{outline:"none"}},h.a.createElement(w.Stage,{onClick:this.handleStageClick,onMouseMove:this.handleMouseOver,onWheel:function(e){return t.handleWheel(e)},height:window.innerHeight,width:window.innerWidth,ref:"graphicStage"},h.a.createElement(w.Layer,{scaleX:this.state.layerScale,scaleY:this.state.layerScale,x:this.state.layerX,y:this.state.layerY,height:window.innerHeight,width:window.innerWidth,draggable:!0,onDragEnd:function(){t.setState({layerX:t.refs.layer2.x(),layerY:t.refs.layer2.y()})},ref:"layer2"},h.a.createElement(w.Rect,{x:-5*window.innerWidth,y:-5*window.innerHeight,height:10*window.innerHeight,width:10*window.innerWidth,name:"",id:"ContainerRect"}),this.state.rectangles.map(function(e){return h.a.createElement(w.Rect,{onClick:function(){var a=t;void 0!==e.link&&""!==e.link&&t.setState({errMsg:"Links will not be opened in create mode"},function(){setTimeout(function(){a.setState({errMsg:""})},1e3)})},onTransformStart:function(){t.setState({isTransforming:!0});var a=t.refs[e.ref];a.setAttr("lastRotation",a.rotation())},onTransform:function(){var a=t.refs[e.ref];a.attrs.lastRotation!==a.rotation()&&t.state.arrows.map(function(e){e.to&&e.to.name()===a.name()&&t.setState({errMsg:"Rotating rects with connectors might skew things up!"}),e.from&&e.from.name()===a.name()&&t.setState({errMsg:"Rotating rects with connectors might skew things up!"})}),a.setAttr("lastRotation",a.rotation())},onTransformEnd:function(){t.setState({isTransforming:!1});var a=t.refs[e.ref];t.setState(function(t){return{errMsg:"",rectangles:t.rectangles.map(function(t){return t.name===a.attrs.name?Object(u.a)({},t,{width:a.width()*a.scaleX(),height:a.height()*a.scaleY(),rotation:a.rotation(),x:a.x(),y:a.y()}):t})}},function(){t.forceUpdate()}),a.setAttr("scaleX",1),a.setAttr("scaleY",1)},rotation:e.rotation,ref:e.ref,fill:e.fill,name:e.name,x:e.x,y:e.y,width:e.width,height:e.height,stroke:e.stroke,strokeWidth:e.strokeWidth,strokeScaleEnabled:!1,draggable:!0,onDragMove:function(){t.state.arrows.map(function(a){void 0!==a.from&&e.name===a.from.attrs.name&&(a.points=[e.x,e.y,a.points[2],a.points[3]],t.forceUpdate()),void 0!==a.to&&e.name==a.to.attrs.name&&(a.points=[a.points[0],a.points[1],e.x,e.y],t.forceUpdate())})},onDragEnd:function(a){var r=t.refs[e.ref];t.setState(function(t){return{rectangles:t.rectangles.map(function(t){return t.name===r.attrs.name?Object(u.a)({},t,{x:a.target.x(),y:a.target.y()}):t})}})}})}),this.state.ellipses.map(function(e){return h.a.createElement(w.Ellipse,{ref:e.ref,name:e.name,x:e.x,y:e.y,rotation:e.rotation,radiusX:e.radiusX,radiusY:e.radiusY,fill:e.fill,stroke:e.stroke,strokeWidth:e.strokeWidth,strokeScaleEnabled:!1,onClick:function(){var a=t;void 0!==e.link&&""!==e.link&&t.setState({errMsg:"Links will not be opened in create mode"},function(){setTimeout(function(){a.setState({errMsg:""})},1e3)})},onTransformStart:function(){t.setState({isTransforming:!0});var a=t.refs[e.ref];a.setAttr("lastRotation",a.rotation())},onTransform:function(){var a=t.refs[e.ref];a.attrs.lastRotation!==a.rotation()&&t.state.arrows.map(function(e){e.to&&e.to.name()===a.name()&&t.setState({errMsg:"Rotating ellipses with connectors might skew things up!"}),e.from&&e.from.name()===a.name()&&t.setState({errMsg:"Rotating ellipses with connectors might skew things up!"})}),a.setAttr("lastRotation",a.rotation())},onTransformEnd:function(){t.setState({isTransforming:!1});var a=t.refs[e.ref];a.scaleX(),a.scaleY();t.setState(function(t){return{errMsg:"",ellipses:t.ellipses.map(function(t){return t.name===a.attrs.name?Object(u.a)({},t,{radiusX:a.radiusX()*a.scaleX(),radiusY:a.radiusY()*a.scaleY(),rotation:a.rotation(),x:a.x(),y:a.y()}):t})}}),a.setAttr("scaleX",1),a.setAttr("scaleY",1),t.forceUpdate()},draggable:!0,onDragMove:function(){console.log("name of ellipse moving: ",e.name,"new x y",e.x,e.y),t.state.arrows.map(function(a){void 0!==a.from&&(console.log("prevArrow: ",a.points),e.name==a.from.attrs.name&&(a.points=[e.x,e.y,a.points[2],a.points[3]],t.forceUpdate(),t.refs.graphicStage.draw()),console.log("new arrows:",a.points)),void 0!==a.to&&e.name===a.to.attrs.name&&(a.points=[a.points[0],a.points[1],e.x,e.y],t.forceUpdate(),t.refs.graphicStage.draw())})},onDragEnd:function(a){var r=t.refs[e.ref];t.setState(function(t){return{ellipses:t.ellipses.map(function(t){return t.name===r.attrs.name?Object(u.a)({},t,{x:a.target.x(),y:a.target.y()}):t})}}),t.refs.graphicStage.draw()}})}),this.state.stars.map(function(e){return h.a.createElement(w.Star,{ref:e.ref,name:e.name,x:e.x,y:e.y,innerRadius:e.innerRadius,outerRadius:e.outerRadius,numPoints:e.numPoints,stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill,strokeScaleEnabled:!1,rotation:e.rotation,onClick:function(){var a=t;void 0!==e.link&&""!==e.link&&t.setState({errMsg:"Links will not be opened in create mode"},function(){setTimeout(function(){a.setState({errMsg:""})},1e3)})},onTransformStart:function(){t.setState({isTransforming:!0})},onTransformEnd:function(){t.setState({isTransforming:!1});var a=t.refs[e.ref];a.scaleX(),a.scaleY();t.setState(function(t){return{stars:t.stars.map(function(t){return t.name===a.attrs.name?Object(u.a)({},t,{innerRadius:a.innerRadius()*a.scaleX(),outerRadius:a.outerRadius()*a.scaleX(),rotation:a.rotation(),x:a.x(),y:a.y()}):t})}}),a.setAttr("scaleX",1),a.setAttr("scaleY",1),t.forceUpdate()},draggable:!0,onDragMove:function(){t.state.arrows.map(function(a){void 0!==a.from&&e.name==a.from.attrs.name&&(a.points=[e.x,e.y,a.points[2],a.points[3]],t.forceUpdate()),void 0!==a.to&&e.name===a.to.attrs.name&&(a.points=[a.points[0],a.points[1],e.x,e.y],t.forceUpdate())})},onDragEnd:function(a){var r=t.refs[e.ref];t.setState(function(t){return{stars:t.stars.map(function(t){return t.name===r.attrs.name?Object(u.a)({},t,{x:a.target.x(),y:a.target.y()}):t})}})}})}),this.state.texts.map(function(e){return h.a.createElement(w.Text,{textDecoration:e.link?"underline":"",onTransformStart:function(){var e=t.refs[t.state.selectedShapeName];e.setAttr("lastRotation",e.rotation())},onTransform:function(){var e=t.refs[t.state.selectedShapeName];e.setAttr("width",e.width()*e.scaleX()),e.setAttr("scaleX",1),e.draw(),e.attrs.lastRotation!==e.rotation()&&t.state.arrows.map(function(a){a.to&&a.to.name()===e.name()&&t.setState({errMsg:"Rotating texts with connectors might skew things up!"}),a.from&&a.from.name()===e.name()&&t.setState({errMsg:"Rotating texts with connectors might skew things up!"})}),e.setAttr("lastRotation",e.rotation())},onTransformEnd:function(){var e=t.refs[t.state.selectedShapeName];t.setState(function(a){return{errMsg:"",texts:a.texts.map(function(a){return a.name===t.state.selectedShapeName?Object(u.a)({},a,{width:e.width(),rotation:e.rotation(),textWidth:e.textWidth,textHeight:e.textHeight,x:e.x(),y:e.y()}):a})}}),e.setAttr("scaleX",1),e.draw()},link:e.link,width:e.width,fill:e.fill,name:e.name,ref:e.ref,rotation:e.rotation,fontFamily:e.fontFamily,fontSize:e.fontSize,x:e.x,y:e.y,text:e.text,draggable:!0,onDragMove:function(){t.state.arrows.map(function(a){void 0!==a.from&&e.name===a.from.attrs.name&&(a.points=[e.x,e.y,a.points[2],a.points[3]],t.forceUpdate()),void 0!==a.to&&e.name===a.to.attrs.name&&(a.points=[a.points[0],a.points[1],e.x,e.y],t.forceUpdate())})},onDragEnd:function(a){var r=t.refs[e.ref];t.setState(function(t){return{texts:t.texts.map(function(t){return t.name===r.attrs.name?Object(u.a)({},t,{x:a.target.x(),y:a.target.y()}):t})}})},onClick:function(){var a=t;void 0!==e.link&&""!==e.link&&t.setState({errMsg:"Links will not be opened in create mode"},function(){setTimeout(function(){a.setState({errMsg:""})},1e3)})},onDblClick:function(){var a=t.refs.graphicStage,r=a.findOne("."+e.name);t.setState({textX:r.absolutePosition().x,textY:r.absolutePosition().y,textEditVisible:!t.state.textEditVisible,text:e.text,textNode:e,currentTextRef:e.ref,textareaWidth:r.textWidth,textareaHeight:r.textHeight,textareaFill:r.attrs.fill,textareaFontFamily:r.attrs.fontFamily,textareaFontSize:r.attrs.fontSize}),t.refs.textarea.focus(),r.hide(),a.findOne(".transformer").hide(),t.refs.layer2.draw()}})}),this.state.arrows.map(function(e){return e.from||e.to?e.name===t.state.newArrowRef&&(e.from||e.to)?h.a.createElement(S,{name:e.name,from:e.from,to:e.to,arrowEndX:t.state.arrowEndX,arrowEndY:t.state.arrowEndY,current:!0,stroke:e.stroke,fill:e.fill}):e.from||e.to?h.a.createElement(S,{name:e.name,from:e.from,to:e.to,points:e.points,current:!1,stroke:e.stroke,fill:e.fill}):void 0:h.a.createElement(w.Arrow,{ref:e.ref,name:e.name,points:[e.points[0],e.points[1],e.points[2],e.points[3]],stroke:e.stroke,fill:e.fill,draggable:!0,onDragEnd:function(a){var r=[e.points[0],e.points[1],e.points[2],e.points[3]],s=t.refs[e.ref].attrs.x,n=t.refs[e.ref].attrs.y,i=[r[0]+s,r[1]+n,r[2]+s,r[3]+n];t.refs[e.ref].position({x:0,y:0}),t.refs.layer2.draw(),t.setState(function(t){return{arrows:t.arrows.map(function(t){return t.name===e.name?Object(u.a)({},t,{points:i}):t})}})}})}),(this.state.selectedShapeName.includes("text"),h.a.createElement(M,{selectedShapeName:this.state.selectedShapeName}))),h.a.createElement(w.Layer,{height:window.innerHeight,width:window.innerWidth,ref:"layer"},h.a.createElement(k,{layer:this.refs.layer2,rectName:this.state.rectangles.length+1+this.state.rectDeleteCount,ellipseName:this.state.ellipses.length+1+this.state.ellipseDeleteCount,starName:this.state.stars.length+1+this.state.starDeleteCount,textName:this.state.texts.length+1+this.state.textDeleteCount,newArrowOnDragEnd:function(e){if(void 0!==e.from){(s=t.refs.layer2.getAbsoluteTransform().copy()).invert();var a=s.point({x:e.x,y:e.y});e.x=a.x,e.y=a.y;var r={points:e.points,ref:"arrow"+(t.state.arrows.length+1+t.state.arrowDeleteCount),name:"arrow"+(t.state.arrows.length+1+t.state.arrowDeleteCount),from:e.from,stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill};t.setState(function(t){return{arrows:[].concat(Object(p.a)(t.arrows),[r]),newArrowDropped:!0,newArrowRef:r.name,arrowEndX:e.x,arrowEndY:e.y}})}else{var s;(s=t.refs.layer2.getAbsoluteTransform().copy()).invert();var n=s.point({x:e.x,y:e.y});e.x=n.x,e.y=n.y;r={points:[e.x,e.y,e.x,e.y],ref:"arrow"+(t.state.arrows.length+1+t.state.arrowDeleteCount),name:"arrow"+(t.state.arrows.length+1+t.state.arrowDeleteCount),from:e.from,stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill};t.setState(function(t){return{arrows:[].concat(Object(p.a)(t.arrows),[r]),newArrowDropped:!0,newArrowRef:r.name,arrowEndX:e.x,arrowEndY:e.y}})}},appendToRectangles:function(e){var a=t.refs.layer2,r=e,s=(t.refs.graphicStage,t.refs.layer2.getAbsoluteTransform().copy());s.invert();var n=s.point({x:r.x,y:r.y});null===a.attrs.x&&void 0===a.attrs.x||(r.x=n.x,r.y=n.y),t.setState(function(t){return{rectangles:[].concat(Object(p.a)(t.rectangles),[r]),selectedShapeName:r.name}})},appendToEllipses:function(e){var a=t.refs.layer2,r=e,s=(t.refs.graphicStage,t.refs.layer2.getAbsoluteTransform().copy());s.invert();var n=s.point({x:r.x,y:r.y});null===a.attrs.x&&void 0===a.attrs.x||(r.x=n.x,r.y=n.y),t.setState(function(t){return{ellipses:[].concat(Object(p.a)(t.ellipses),[r]),selectedShapeName:r.name}})},appendToStars:function(e){var a=t.refs.layer2,r=e,s=(t.refs.graphicStage,t.refs.layer2.getAbsoluteTransform().copy());s.invert();var n=s.point({x:r.x,y:r.y});null===a.attrs.x&&void 0===a.attrs.x||(r.x=n.x,r.y=n.y),t.setState(function(t){return{stars:[].concat(Object(p.a)(t.stars),[r]),selectedShapeName:r.name}})},appendToTexts:function(e){var a=t.refs.layer2,r=e,s=(t.refs.graphicStage,t.refs.layer2.getAbsoluteTransform().copy());s.invert();var n=s.point({x:r.x,y:r.y});null===a.attrs.x&&void 0===a.attrs.x||(r.x=n.x,r.y=n.y),t.setState(function(t){return{texts:[].concat(Object(p.a)(t.texts),[r])}}),t.refs[r.ref].fire("dblclick")}}))),h.a.createElement("textarea",{ref:"textarea",id:"textarea",value:this.state.text,onChange:function(e){t.setState({text:e.target.value,shouldTextUpdate:!1})},onKeyDown:function(e){if(13===e.keyCode){t.setState({textEditVisible:!1,shouldTextUpdate:!0});var a=t.refs[t.state.currentTextRef];console.log("node width before set",a.textWidth);var r=a.attrs.name;t.setState(function(e){return{selectedShapeName:r,texts:e.texts.map(function(e){return e.name===r?Object(u.a)({},e,{text:t.state.text}):e})}},function(){t.setState(function(t){return{texts:t.texts.map(function(t){return t.name===r?Object(u.a)({},t,{textWidth:a.textWidth,textHeight:a.textHeight}):t})}})}),a.show(),t.refs.graphicStage.findOne(".transformer").show()}},onBlur:function(){t.setState({textEditVisible:!1,shouldTextUpdate:!0});var e=t.refs.graphicStage.findOne("."+t.state.currentTextRef),a=e.attrs.name;t.setState(function(e){return{selectedShapeName:a,texts:e.texts.map(function(e){return e.name===a?Object(u.a)({},e,{text:t.state.text}):e})}},function(){t.setState(function(t){return{texts:t.texts.map(function(t){return t.name===a?Object(u.a)({},t,{textWidth:e.textWidth,textHeight:e.textHeight}):t})}})}),e.show(),t.refs.graphicStage.findOne(".transformer").show(),t.refs.graphicStage.draw()},style:{display:this.state.textEditVisible?"block":"none",position:"absolute",top:this.state.textY+80+"px",left:this.state.textX+"px",width:"300px",height:"300px",overflow:"hidden",fontSize:this.state.textareaFontSize,fontFamily:this.state.textareaFontFamily,color:this.state.textareaFill,border:"none",padding:"0px",margin:"0px",outline:"none",resize:"none",background:"none"}}),h.a.createElement("div",{className:"errMsg"},r)))}}]),e}(l.Component);h.a.Component;d.a.render(h.a.createElement(P,null),document.getElementById("root"))},39:function(t,e,a){t.exports=a(101)},44:function(t,e,a){},97:function(t,e,a){}},[[39,2,1]]]);
//# sourceMappingURL=main.b97f7b4c.chunk.js.map